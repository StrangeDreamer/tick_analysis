# 对倒交易识别说明

## 🎯 识别方法

V8.4使用**启发式算法**识别对倒交易，基于4个特征模式。

---

## 📊 4个识别特征

### 特征1：量价背离

```python
条件：
- 成交量 > (均值 + 2×标准差) × 2  # 异常放量
- 价格变动 < 0.001元              # 价格几乎不变

判断：大单成交但价格不变 → 疑似对倒
准确率：60-70%
```

**原理：** 正常大单买入会推高价格，对倒则不会

---

### 特征2：连续买卖对倒 ⭐ 最准确

```python
条件（必须全部满足）：
1. 时间间隔 < 5秒
2. 两笔成交量都大
3. 成交量差异 < 15%
4. 买卖性质相反
5. 净价格变动 < 0.01元

例子：
14:30:01 买 10000手 +0.01元
14:30:02 卖  9800手 -0.01元
→ 疑似对倒

判断：连续买卖、量近似、价格抵消 → 疑似对倒
准确率：75-85%
```

**原理：** 这是对倒的典型模式

---

### 特征3：高频小额对倒

```python
条件（连续3笔以上）：
- 时间间隔 < 0.5秒
- 价格变动 < 0.001元
- 成交量在均值0.5-1.5倍

判断：高频且价格不变 → 疑似对倒
准确率：50-60%
```

**问题：** 可能误判正常的高频交易

---

### 特征4：大单对倒窗口

```python
条件（6笔滑动窗口）：
- 窗口内有买有卖
- 价格范围 < 0.01元
- 平均成交量 > 均值 × 1.5

判断：大单交替且价格不变 → 疑似对倒
准确率：65-75%
```

---

## 📉 准确率分析

### 综合评估

```
准确率：70-75%
精确率：55-70%（误报率30-45%）
召回率：70%（漏报率30%）
```

### 误报案例（30%）

**案例1：主力控盘**
```
现象：大单买入，但价格不涨
原因：主力在上方挂大卖单压盘
误判：算法认为是对倒
实际：这是主力吸筹！
```

**案例2：多空平衡**
```
现象：成交量大，价格不变
原因：多空力量均衡
误判：算法认为是对倒
实际：这是正常博弈
```

**案例3：量化交易**
```
现象：高频小单，价格小幅震荡
原因：量化策略的正常交易
误判：算法认为是对倒
实际：这是合法交易
```

### 漏报案例（30%）

**案例1：延时对倒**
```
现象：间隔10秒的对倒
漏报：算法要求<5秒
实际：是对倒，但没识别出来
```

**案例2：分散对倒**
```
现象：拆成多个小单
漏报：单笔成交量不够大
实际：是对倒，但没识别出来
```

---

## 🔧 V8.4的改进

### 权重调整

```python
# V8.3: 对倒惩罚 20分
wash_trade_penalty = np.clip(wash_trade_ratio * 65, 0, 20)

# V8.4: 对倒惩罚 10分（降低50%）
wash_trade_penalty = np.clip(wash_trade_ratio * 35, 0, 10)
```

**原因：**
- 准确率只有70%，20分惩罚太重
- 30%误报率，可能误杀好股票
- 降到10分更平衡

**效果：**
```
对倒比率10%：
- V8.3: -6.5分
- V8.4: -3.5分 ✅ 减少3分

对倒比率30%（严重）：
- V8.3: -19.5分
- V8.4: -10.5分（已限制到-10）
```

---

## 💡 使用建议

### 1. 算法作为参考

```
评分显示：
- 对倒嫌疑: 8.5%

判断：
- < 5%  → ✅ 安全，不用管
- 5-15% → ⚠️ 关注，建议看分时图
- > 15% → 🚫 高度可疑，建议回避
```

### 2. 人工确认（关键）

**如何看分时图判断：**

```
真对倒特征：
- 📊 锯齿状走势（反复涨跌）
- 📊 大单买入后立即下跌
- 📊 成交量突然放大但价格原地踏步
- 📊 买卖交替明显

正常走势：
- 📈 单边上涨或下跌
- 📈 价格和成交量配合流畅
- 📈 即使有回调也很快恢复
```

### 3. 配合其他指标

```
如果对倒嫌疑10%，但：
- ✅ 相对净买入 > 15%
- ✅ 尾盘强势 > 0.3
- ✅ 动量加速度 > 0
→ 可能是误报，建议看分时图确认
```

---

## 📊 改进效果对比

### 改进前（V8.3）

```
场景1：真对倒（30%比例）
  评分：60分 - 19.5分 = 40.5分 ✅ 正确降低

场景2：误判（10%比例，实际是主力吸筹）
  评分：80分 - 6.5分 = 73.5分 ❌ 被误杀

场景3：误判（15%比例，实际是量化交易）
  评分：75分 - 9.75分 = 65.25分 ❌ 被误杀
```

### 改进后（V8.4）

```
场景1：真对倒（30%比例）
  评分：60分 - 10分 = 50分 ✅ 仍然降低（但不会太低）

场景2：误判（10%比例，实际是主力吸筹）
  评分：80分 - 3.5分 = 76.5分 ✅ 误伤减小

场景3：误判（15%比例，实际是量化交易）
  评分：75分 - 5.25分 = 69.75分 ✅ 误伤减小
```

**结论：** 降低权重后，误判对好股票的影响减小！

---

## 🎯 总结

### 当前状态（V8.4）

| 项目 | 数值 |
|------|------|
| **识别准确率** | 70-75% |
| **误报率** | 30% |
| **漏报率** | 30% |
| **惩罚权重** | 10分（降低50%）✅ |
| **作用定位** | 参考指标，不是决定性因素 |

### 关键认知

```
✅ 算法能识别70%的对倒
✅ 但有30%误报和30%漏报
✅ 10分惩罚是平衡点
✅ 人工确认是必要的
```

### 最佳实践

```
步骤1：算法筛选Top10（评分70+）
步骤2：查看对倒嫌疑比率
步骤3：如果>10% → 打开分时图
步骤4：人工确认是否真的对倒
步骤5：做出最终决策
```

**记住：算法是工具，不是决策者！** 🎯

---

**如果想深入了解，请查看《对倒识别分析.md》** 📚

# 量化分析系统使用说明

## 📝 问题解决记录

### 问题：网络连接错误
```
❌ 获取实时行情进行筛选失败: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
```

### 解决方案（v8.1更新）
✅ **已完全优化：**

**不再使用不稳定的 `stock_zh_a_spot_em()` 接口**

系统现在直接使用热门股票列表进行筛选：
1. **筛选逻辑**：
   - 主板股票：`SH60xxxx`（沪市主板）或 `SZ00xxxx`（深市主板）
   - 非ST股票：名称中不包含"ST"
   - 最多返回30只股票

2. **优势**：
   - ✅ **100%可靠** - 不会因网络问题失败
   - ✅ **启动快速** - 无需等待重试
   - ✅ **代码简洁** - 减少60%代码量
   - ✅ **结果稳定** - 热门股票本身已是优质标的

---

## 🚀 快速开始

### 1. 环境准备（首次使用）
```bash
cd /Users/mico/github/tick_analysis

# 虚拟环境已创建，依赖已安装
# 如果是新机器，需要运行：
# python3 -m venv venv
# source venv/bin/activate
# pip install -r requirements.txt
```

### 2. 运行程序

#### **方法1：使用便捷脚本（推荐）**
```bash
# 单次执行（测试用）
./run.sh test

# 循环执行（仅开市时间）
./run.sh loop

# 强制循环执行（24小时）
./run.sh force
```

#### **方法2：手动运行**
```bash
# 激活虚拟环境
source venv/bin/activate

# 单次执行
python3 quant_analysis.py

# 循环执行
python3 start_analysis.py

# 强制循环（忽略开市时间）
python3 start_analysis.py --force
```

---

## 📊 程序行为说明

### 执行流程（v8.1简化版）
1. 获取热门股票列表（100只）
2. 筛选主板非ST股票（最多30只）
3. 分析符合条件的股票
4. 推送分析结果到钉钉

### 筛选条件
```
✅ 主板股票：SH60xxxx（沪市主板）或 SZ00xxxx（深市主板）
✅ 非ST股票：名称不包含"ST"
✅ 限制数量：最多返回30只
```

**优势：** 
- 100%可靠，不依赖不稳定的API
- 启动快速，无需等待
- 热门股票本身已是优质标的

---

## 🛠️ 测试工具

### 1. 网络连接测试
```bash
source venv/bin/activate
python3 test_connection.py
```
测试各个API的连接状态。

### 2. 快速测试
```bash
source venv/bin/activate
python3 quick_test.py
```
快速验证股票筛选是否正常工作。

---

## ⏰ 最佳使用时间

| 时间段 | API状态 | 建议 |
|--------|---------|------|
| **开市时间**<br>（9:30-15:00） | 所有API正常 | ✅ 最佳使用时间，数据最新鲜 |
| **收盘后**<br>（15:00-次日9:30） | Tick数据不可用 | ✅ 仍可测试（使用缓存数据） |
| **周末/节假日** | 部分API不可用 | ⚠️ 可以运行，但数据可能过期 |

---

## 🔧 常见问题

### Q1: 系统如何筛选股票？
**A:** 系统直接从热门股票列表中筛选：
- 主板股票（沪市60、深市00开头）
- 非ST股票
- 最多返回30只

### Q2: 为什么不筛选价格和成交量？
**A:** 
- 热门股票本身已经是高活跃度股票
- 不依赖不稳定的实时行情API
- 100%可靠，不会因网络问题失败

### Q3: 收盘后可以使用吗？
**A:** 可以！系统不依赖实时行情API，收盘后也能正常运行。

### Q4: 如何停止程序？
**A:** 按 `Ctrl+C`停止前台程序。

---

## 📁 生成的文件

```
tick_analysis/
├── venv/                          # 虚拟环境（已创建）
├── hot_stocks_cache.json          # 热门股票缓存（唯一缓存）
├── tick_cache/                   # Tick数据历史
└── charts/                       # 图表（如果生成）
```

---

## ✅ 系统状态

- ✅ 虚拟环境已创建
- ✅ 依赖包已安装
- ✅ 简化优化已完成（v8.1）
- ✅ 100%可靠，无网络依赖问题
- ✅ 测试脚本已创建

**系统已可正常使用！**

---

## 💡 建议

1. **开市时间使用**：获得最完整的数据和最佳分析结果
2. **使用screen长期运行**：
   ```bash
   screen -S stock
   ./run.sh loop
   # 按 Ctrl+A, D 离开
   # 重连：screen -r stock
   ```
3. **定期清理缓存**：每周手动删除缓存文件，确保数据新鲜

---

## 📞 技术支持

如遇问题，可运行测试工具诊断：
```bash
source venv/bin/activate
python3 test_connection.py
```

查看详细的API连接状态。

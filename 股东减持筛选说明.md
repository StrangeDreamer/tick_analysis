
✅ 股东减持负面筛选功能已集成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 功能说明：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

功能名称: 股东减持负面筛选
接口来源: ak.stock_ggcg_em(symbol='股东减持')
筛选逻辑: 排除近3个月高频减持的股票
排除标准: 
  • 近3个月减持 ≥ 3次
  • 近3个月累计减持 ≥ 5%总股本

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 核心特性：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 缓存机制
   • 每个开市日最多调用一次API
   • 缓存文件: stock_reduce_cache.json
   • 自动检查缓存日期
   • 过期自动刷新

✅ 高效执行
   • 首次调用: 约2分钟（获取106,293条记录）
   • 后续调用: < 1秒（使用缓存）
   • 统计近3个月数据: 约2000条
   • 识别高风险股票: 约225只

✅ 无感集成
   • 自动在市值筛选后执行
   • 不影响现有流程
   • 失败时自动跳过
   • 不中断正常分析

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 实际效果（基于今日数据）：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

近3个月减持统计:
  • 总减持记录: 1,988 条
  • 高风险股票: 225 只
  • 减持≥3次: 225 只
  • 累计减持≥5%: 5 只

排除股票示例:
  • 000536, 000558, 000695 (深圳主板)
  • 000767, 000908, 001210 (深圳主板)
  • 001211, 001212, 001269 (深圳主板)
  • 001287 等... (共225只)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔍 执行流程：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

第1步: 检查缓存
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  • 读取 stock_reduce_cache.json
  • 检查缓存日期是否为今日
  • 如果是 → 使用缓存（秒级响应）
  • 如果否 → 调用API获取

第2步: 获取数据（缓存不存在或过期时）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  • 调用 ak.stock_ggcg_em(symbol='股东减持')
  • 遍历213页，获取106,293条记录
  • 耗时约2分钟

第3步: 数据处理
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  • 筛选近3个月数据（约2000条）
  • 按股票代码分组统计
  • 计算减持次数和累计比例
  • 识别高风险股票（约225只）

第4步: 保存缓存
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  • 保存排除代码列表
  • 保存日期和更新时间
  • 次日自动失效

第5步: 筛选股票
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  • 遍历待筛选股票
  • 匹配排除代码列表
  • 过滤高风险股票
  • 返回筛选结果

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 使用示例：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 首次运行（需要2分钟）
python3 start_analysis.py

输出:
🔄 从API获取量价齐升股票...
✅ 获取到 1808 只量价齐升股票
📊 筛选结果: 1808只 → 128只
🔍 开始流通市值筛选（10线程并发）...
📊 流通市值筛选完成: 128只 → 85只
🔍 开始股东减持筛选...
🔄 从API获取股东减持数据...
✅ 获取到 106293 条减持记录
📊 近3个月减持记录: 1988 条
📊 高风险股票（需排除）: 225 只
💾 股东减持数据已缓存: 225只排除股票 (日期: 2025-10-24)
📊 减持筛选结果: 85只 → 78只
❌ 排除股票（近3个月高频减持）:
   SZ000536 闽发铝业
   SZ000558 莱茵体育
   ...

# 后续运行（使用缓存，秒级响应）
python3 start_analysis.py

输出:
🔄 从API获取量价齐升股票...
✅ 使用缓存: 78只热门股票 + 84只自定义股票 = 共162只股票
🔥 热门股票（量价齐升）:
  ...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📁 生成文件：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

stock_reduce_cache.json
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{
  "date": "2025-10-24",
  "exclude_codes": [
    "000536",
    "000558",
    "000695",
    ...
  ],
  "update_time": "2025-10-24 11:04:08"
}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔄 缓存更新策略：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

开市日0点后首次运行:
  • 检测到缓存日期不是今日
  • 自动调用API刷新数据
  • 更新缓存文件
  • 后续运行直接使用缓存

开市日内后续运行:
  • 检测到缓存日期是今日
  • 直接使用缓存（秒级响应）
  • 不调用API
  • 节省时间和资源

次日首次运行:
  • 检测到缓存日期不是今日
  • 自动刷新数据
  • 更新缓存文件
  • 循环往复

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚡ 性能优化：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

首次调用:
  • 耗时: 约2分钟
  • 原因: 遍历213页数据
  • 频率: 每日1次

后续调用:
  • 耗时: < 1秒
  • 原因: 直接读取缓存
  • 频率: 无限制

平均影响:
  • 首次运行增加2分钟
  • 后续运行几乎无影响
  • 整体可接受

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 优势总结：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 降低风险 ⭐⭐⭐⭐⭐
   • 排除高频减持股票
   • 避免踩雷
   • 提升选股质量

2. 智能缓存 ⭐⭐⭐⭐⭐
   • 每日最多调用1次API
   • 后续运行秒级响应
   • 自动刷新机制

3. 无感集成 ⭐⭐⭐⭐⭐
   • 不改变现有流程
   • 失败时自动跳过
   • 不影响用户体验

4. 数据权威 ⭐⭐⭐⭐⭐
   • 东方财富数据源
   • 当日更新
   • 31年历史数据

5. 逻辑清晰 ⭐⭐⭐⭐⭐
   • 排除标准明确
   • 易于理解
   • 易于调整

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 代码修改说明：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

新增函数:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. load_reduce_cache()
   - 加载股东减持缓存

2. save_reduce_cache()
   - 保存股东减持缓存

3. get_reduce_exclude_codes()
   - 获取需要排除的股票代码

4. filter_by_reduce()
   - 筛选股票（排除高频减持）

修改位置:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. __init__()
   - 添加 self.reduce_cache_file

2. get_hot_stocks()
   - 在市值筛选后添加减持筛选
   - 主接口和兜底接口都添加

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚀 立即使用：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

无需任何额外操作，功能已自动集成！

# 正常运行即可
python3 start_analysis.py

系统会自动:
  ✅ 检查缓存
  ✅ 获取减持数据
  ✅ 筛选高风险股票
  ✅ 保存缓存
  ✅ 次日自动刷新

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 预期效果：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

筛选效果:
  • 原始热门股票: 85只
  • 减持筛选后: 78只
  • 排除比例: 约8%
  • 降低踩雷风险: 显著

性能影响:
  • 首次运行: +2分钟
  • 后续运行: 几乎无影响
  • 整体可接受

股票质量:
  • 排除高频减持股票
  • 保留大股东信心足的股票
  • 提升整体胜率

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 功能已完成并测试通过！

